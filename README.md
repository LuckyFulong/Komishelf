# Komi 书架 (Komi Bookshelf)

Komi 书架是一个专为漫画爱好者设计的本地漫画管理和阅读系统。它提供了一个现代化、直观的Web界面，让您可以轻松地组织、浏览和阅读存储在本地的漫画文件。通过自动扫描、实时文件监控、智能分类和丰富的管理功能，Komi 书架旨在为您打造一个高效且愉悦的漫画阅读体验。

## 功能特性

*   **全面的漫画管理**
    *   **智能识别与导入:** 自动扫描指定文件夹中的ZIP/CBZ格式漫画文件，并将其添加到您的漫画库。
    *   **多维度浏览:** 支持按分页、收藏状态、在线/本地来源、下载状态或自定义文件夹进行筛选，并可按漫画名称或添加日期灵活排序。
    *   **详细信息概览:** 查看每本漫画的封面、标题、显示名称、标签、阅读进度等详细信息。
    *   **个性化定制:** 轻松修改漫画的显示名称，标记您喜爱的漫画以便快速访问。
    *   **灵活的删除策略:** 支持将本地漫画文件安全地移动到回收站，并自动清理相关封面缓存；也可批量删除多本漫画及其数据。
    *   **在线与本地融合:** 智能合并在线漫画的元数据与本地文件，实现统一管理，避免重复。
*   **沉浸式阅读体验**
    *   **Web端阅读器:** 直接在浏览器中流畅阅读本地ZIP/CBZ格式的漫画文件。
    *   **自动进度跟踪:** 精确记录每本漫画的阅读页码，方便您随时继续阅读。
*   **自动化与智能化**
    *   **后台自动扫描:** 首次启动或手动触发时，在后台静默扫描新增或更新的漫画文件。
    *   **实时文件系统监控:** 持续监控指定漫画文件夹，自动检测文件的添加、修改、删除或移动，并同步更新数据库。
    *   **扫描进度可视化:** 提供实时的扫描进度反馈，让您了解当前操作状态。
    *   **智能文件夹分类:** 创建自定义文件夹，并配置基于漫画名称或标签的自动分类规则，让您的漫画库井井有条。
*   **数据同步与扩展**
    *   **Tampermonkey 脚本集成:** 通过API接口与外部Tampermonkey脚本无缝同步在线漫画信息（包括标题、封面URL、标签等），极大丰富您的漫画元数据。
*   **系统维护与配置**
    *   **数据库优化:** 自动清理数据库中指向不存在本地文件的漫画条目，保持数据一致性。
    *   **封面缓存管理:** 智能清理不再被任何漫画引用的封面图片，有效节省存储空间。
    *   **一键重置:** 提供清除所有漫画数据、标签、文件夹、配置和封面缓存的选项，方便应用重置或重新配置。
    *   **直观的配置界面:** 方便地添加、移除或迁移需要扫描和监控的漫画存储文件夹，并管理应用的基本设置。
*   **现代化Web界面**
    *   采用响应式设计，提供友好且一致的用户体验，无论在桌面还是移动设备上都能轻松访问和管理您的漫画。

## 技术栈

*   **后端:** Python (Flask, SQLite, Watchdog, Pillow, rarfile)
*   **前端:** HTML, CSS, JavaScript

## 快速开始

### 1. 环境准备

确保您的系统已安装 Python 3.8+ 和 `pip`。

### 2. 安装依赖

在项目根目录下打开命令行，运行以下命令安装所有必要的 Python 依赖：

```bash
pip install -r requirements.txt
```
**注意:** `requirements.txt` 文件应包含以下核心依赖：
```
Flask
watchdog
Pillow
rarfile
send2trash
```

### 3. 运行应用

```bash
python app/main.py
```

应用启动后，会自动在您的默认浏览器中打开Web界面（通常是 `http://127.0.0.1:5000`）。

### 4. 配置漫画文件夹

首次启动后，您需要在Web界面中导航到设置页面，添加包含漫画文件的文件夹。应用将自动扫描这些文件夹并将其内容添加到您的漫画库中。

## 使用说明

*   **浏览与搜索:** 在主界面利用强大的搜索、筛选和排序功能，快速定位您想阅读的漫画。
*   **开始阅读:** 点击任何漫画封面即可进入全屏阅读模式，享受流畅的阅读体验。您的阅读进度将自动保存。
*   **管理您的收藏:** 通过漫画详情页或批量操作，您可以轻松地收藏、编辑漫画信息，或将其分配到不同的自定义文件夹。
*   **自定义分类:** 在设置中创建和管理自定义文件夹，并设置自动分类规则，让您的漫画库保持整洁有序。
*   **在线数据增强:** 如果您使用Tampermonkey脚本收集了在线漫画信息，可以通过API接口将其同步到Komi书架，丰富您的本地元数据。
*   **定期维护:** 利用系统提供的清理功能，定期维护数据库和封面缓存，确保应用高效运行。

## 目录结构

```
.
├── app/
│   ├── comics.db             # SQLite 数据库文件
│   ├── config.json           # 应用配置文件
│   ├── config.py             # 配置加载与保存逻辑
│   ├── database.py           # 数据库操作模块
│   ├── main.py               # 应用入口文件
│   ├── routes.py             # Flask 路由和 API 接口
│   ├── scanner.py            # 漫画扫描逻辑
│   ├── watchdog_service.py   # 文件系统监控服务
│   └── web/                  # 前端静态文件 (HTML, CSS, JS)
│       ├── index.html
│       ├── script.js
│       ├── style.css
│       └── covers/           # 漫画封面缓存目录
│           ├── large/
│           ├── medium/
│           └── thumbnail/
├── start.bat                 # Windows 启动脚本 (如果存在)
└── README.md                 # 本说明文件
```

## 注意事项

*   **漫画文件格式:** 目前主要支持 `.zip` 和 `.cbz` 格式的漫画文件。对 `.rar` 格式的支持有限，可能需要额外的系统库。
*   **安全性:** 请确保您添加的漫画文件夹是可信的，并且不包含敏感或恶意文件。
*   **性能考量:** 大量漫画文件可能会影响首次扫描和某些操作的性能。建议在首次导入大量漫画时耐心等待。

希望您喜欢使用 Komi 书架，享受您的漫画世界！
